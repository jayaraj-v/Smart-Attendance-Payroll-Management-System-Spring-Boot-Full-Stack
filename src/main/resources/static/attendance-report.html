<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Today's Attendance Report - EPV System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/x-icon" href="./Images/cropped_circle_image%20(1).png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
          margin: 0;
          font-family: 'Segoe UI', sans-serif;
          background-color: #ecf0f1;
        }

        .header {
          background-color: #2c3e50;
          color: white;
          padding: 20px;
          text-align: center;
        }

        .main {
          padding: 30px;
        }

        h2 {
          margin-bottom: 20px;
          color: #2c3e50;
        }

        .export-buttons {
          margin-bottom: 20px;
        }

        .export-buttons button {
          padding: 10px 15px;
          margin-right: 10px;
          background-color: #3498db;
          border: none;
          color: white;
          font-weight: bold;
          cursor: pointer;
          border-radius: 5px;
        }

        table {
          width: 100%;
          border-collapse: collapse;
          background-color: white;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 0 8px rgba(0,0,0,0.1);
        }

        th, td {
          padding: 14px;
          text-align: center;
          border-bottom: 1px solid #ddd;
        }

        th {
          background-color: #2980b9;
          color: white;
        }

        tr:hover {
          background-color: #f2f2f2;
        }

        .status-present {
          background-color: #2ecc71;
          color: white;
          font-weight: bold;
        }

        .status-late {
          background-color: #f1c40f;
          color: black;
          font-weight: bold;
        }

        .status-absent {
          background-color: #e74c3c;
          color: white;
          font-weight: bold;
        }

        @media (max-width: 768px) {
          table {
            font-size: 14px;
          }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üìÖ Attendance Report - Today</h1>
</div>

<div class="main">
    <h2>üë• Employee Attendance</h2>

    <div class="export-buttons">
        <button onclick="exportToCSV()">‚¨áÔ∏è Export CSV</button>
        <button onclick="exportToPDF()">‚¨áÔ∏è Export PDF</button>
    </div>

    <table id="attendanceTable">
        <thead>
        <tr>
            <th>EMPLOYEE ID</th>
            <th>NAME</th>
            <th>IN TIME</th>
            <th>OUT TIME</th>
            <th>BREAK (Mins)</th>
            <th>TOTAL HOURS</th>
            <th>STATUS</th>
        </tr>
        </thead>
        <tbody id="attendanceTableBody">
        <!-- Data will be injected here -->
        </tbody>
    </table>
</div>

<script>
    let attendanceData = [];

    fetch('/attendance/today', { credentials: 'include' })
      .then(res => res.json())
      .then(data => {
        attendanceData = data;
        const tbody = document.getElementById('attendanceTableBody');
        data.forEach(emp => {
          const statusClass = emp.status === "PRESENT"
            ? "status-present"
            : emp.status === "LATE"
            ? "status-late"
            : "status-absent";

          const row = `
            <tr>
              <td>${emp.employeeId}</td>
              <td>${emp.name}</td>
              <td>${emp.inTime || '-'}</td>
              <td>${emp.outTime || '-'}</td>
              <td>${emp.breakMinutes || '-'}</td>
              <td>${emp.totalHours || '-'}</td>
              <td class="${statusClass}">${emp.status}</td>
            </tr>`;
          tbody.innerHTML += row;
        });
      })
      .catch(err => {
        console.error('Error fetching attendance data:', err);
      });

    function exportToCSV() {
      let csv = 'EMPLOYEE ID,NAME,IN TIME,OUT TIME,BREAK (Mins),TOTAL HOURS,STATUS\n';
      attendanceData.forEach(emp => {
        csv += `${emp.employeeId},${emp.name},${emp.inTime || '-'},${emp.outTime || '-'},${emp.breakMinutes || '-'},${emp.totalHours || '-'},${emp.status}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'attendance-report-today.csv';
      link.click();
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Today's Attendance Report - EPV System", 10, 10);
      let y = 20;

      doc.setFontSize(10);
      doc.text("ID", 10, y);
      doc.text("Name", 30, y);
      doc.text("In", 70, y);
      doc.text("Out", 90, y);
      doc.text("Break", 115, y);
      doc.text("Total", 135, y);
      doc.text("Status", 160, y);

      y += 8;
      attendanceData.forEach(emp => {
        doc.text(`${emp.employeeId}`, 10, y);
        doc.text(`${emp.name}`, 30, y);
        doc.text(`${emp.inTime || '-'}`, 70, y);
        doc.text(`${emp.outTime || '-'}`, 90, y);
        doc.text(`${emp.breakMinutes || '-'}`, 115, y);
        doc.text(`${emp.totalHours || '-'}`, 135, y);
        doc.text(`${emp.status}`, 160, y);
        y += 8;
        if (y > 280) {
          doc.addPage();
          y = 20;
        }
      });

      doc.save('attendance-report-today.pdf');
    }
</script>

</body>
</html>
