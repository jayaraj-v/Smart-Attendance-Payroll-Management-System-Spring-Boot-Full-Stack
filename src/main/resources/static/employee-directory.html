<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Employee Directory - EPV System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/x-icon" href="./Images/cropped_circle_image%20(1).png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
          margin: 0;
          font-family: 'Segoe UI', sans-serif;
          background-color: #ecf0f1;
        }

        .header {
          background-color: #2c3e50;
          color: white;
          padding: 20px;
          text-align: center;
        }

        .main {
          padding: 30px;
        }

        h2 {
          margin-bottom: 10px;
          color: #2c3e50;
        }

        #searchInput {
          width: 300px;
          padding: 10px;
          margin-bottom: 20px;
          border-radius: 6px;
          border: 1px solid #ccc;
          font-size: 15px;
        }

        .export-buttons {
          margin-bottom: 20px;
        }

        .export-buttons button {
          padding: 10px 15px;
          margin-right: 10px;
          background-color: #3498db;
          border: none;
          color: white;
          font-weight: bold;
          cursor: pointer;
          border-radius: 5px;
        }

        table {
          width: 100%;
          border-collapse: collapse;
          background-color: white;
          box-shadow: 0 0 10px rgba(0,0,0,0.1);
          border-radius: 12px;
          overflow: hidden;
        }

        th, td {
          padding: 16px;
          text-align: left;
          border-bottom: 1px solid #ddd;
        }

        th {
          background-color: #2980b9;
          color: white;
        }

        tr:hover {
          background-color: #f1f1f1;
        }

        @media (max-width: 768px) {
          table {
            font-size: 14px;
          }
          #searchInput {
            width: 100%;
          }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üìá Employee Directory - Explorinno Pvt Ltd</h1>
</div>

<div class="main">
    <h2>üë• Employee Details</h2>

    <input type="text" id="searchInput" placeholder="üîç Search by name, role or ID" />

    <div class="export-buttons">
        <button onclick="exportToCSV()">‚¨áÔ∏è Export as CSV</button>
        <button onclick="exportToPDF()">‚¨áÔ∏è Export as PDF</button>
    </div>

    <table id="employeeTable">
        <thead>
        <tr>
            <th>EMPLOYEE ID</th>
            <th>EMPLOYEE NAME</th>
            <th>ROLE</th>
            <th>EMPLOYEE TYPE</th>
            <th>DAYS WORKED (THIS MONTH)</th>
            <th>DAYS ABSENT</th>
            <th>PERFORMANCE</th>
        </tr>
        </thead>
        <tbody id="employeeTableBody">
        <!-- Data populated by JS -->
        </tbody>
    </table>
</div>

<script>
    let employees = [];

    fetch('/hr/employees/all', { credentials: 'include' })
      .then(res => res.json())
      .then(data => {
        employees = data;
        renderTable(data);
      })
      .catch(err => {
        console.error('Error fetching employee data:', err);
      });

    function renderTable(data) {
      const tbody = document.getElementById('employeeTableBody');
      tbody.innerHTML = "";
      data.forEach(emp => {
        const row = `
          <tr>
            <td>${emp.employeeId}</td>
            <td>${emp.name}</td>
            <td>${emp.role}</td>
            <td>${emp.type}</td>
            <td>${emp.daysWorked}</td>
            <td>${emp.daysAbsent}</td>
            <td>${emp.performance}%</td>
          </tr>`;
        tbody.innerHTML += row;
      });
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      const keyword = e.target.value.toLowerCase();
      const filtered = employees.filter(emp =>
        emp.name.toLowerCase().includes(keyword) ||
        emp.employeeId.toLowerCase().includes(keyword) ||
        emp.role.toLowerCase().includes(keyword)
      );
      renderTable(filtered);
    });

    function exportToCSV() {
      let csv = 'EMPLOYEE ID,EMPLOYEE NAME,ROLE,EMPLOYEE TYPE,DAYS WORKED,DAYS ABSENT,PERFORMANCE\n';
      employees.forEach(emp => {
        csv += `${emp.employeeId},${emp.name},${emp.role},${emp.type},${emp.daysWorked},${emp.daysAbsent},${emp.performance}%\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'employee-directory.csv';
      link.click();
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Employee Directory - Explorinno Pvt Ltd", 10, 10);
      let startY = 20;

      doc.setFontSize(10);
      doc.text("ID", 10, startY);
      doc.text("Name", 30, startY);
      doc.text("Role", 80, startY);
      doc.text("Type", 110, startY);
      doc.text("Worked", 140, startY);
      doc.text("Absent", 160, startY);
      doc.text("Perf.", 180, startY);

      startY += 8;
      employees.forEach(emp => {
        doc.text(`${emp.employeeId}`, 10, startY);
        doc.text(`${emp.name}`, 30, startY);
        doc.text(`${emp.role}`, 80, startY);
        doc.text(`${emp.type}`, 110, startY);
        doc.text(`${emp.daysWorked}`, 140, startY);
        doc.text(`${emp.daysAbsent}`, 160, startY);
        doc.text(`${emp.performance}%`, 180, startY);
        startY += 8;
        if (startY > 280) {
          doc.addPage();
          startY = 20;
        }
      });

      doc.save("employee-directory.pdf");
    }
</script>

</body>
</html>
